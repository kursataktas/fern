imports: 
  commons: commons.yml
  types: types.yml
  examples: examples.yml
  pagination: pagination.yml

types: 
  
  HttpService: 
    extends: 
      - commons.WithDisplayName
    properties: 
      auth: boolean
      url: optional<string>
      base-path: optional<string>
      path-parameters: optional<map<string, string>>
      idempotent: optional<boolean>
      headers: optional<map<string, types.TypeReference>>
      transport: optional<ServiceTransport> 
      source: optional<Source>
      endpoints: optional<map<string, Endpoint>>
  
  Source: 
    discriminated: false
    union: 
      - OpenAPISourceSchema
      - ProtoSourceSchema 
  
  OpenAPISourceSchema: 
    properties: 
      openapi: 
        type: string
        docs: Path to the OpenAPI spec
  
  ProtoSourceSchema: 
    properties: 
      proto: 
        type: string
        docs: Path to the Protobuf spec

  ServiceTransport: 
    properties: 
      grpc: optional<GrpcTransport>        
  
  GrpcTransport: 
    properties: 
      service-name: 
        type: string
        docs: "The name of the gRPC service."
  
  Endpoint:   
    extends: 
      - commons.WithDisplayName
    properties: 
      method: optional<HttpMethod>
      base-path: optional<string>
      path: string
      url: optional<string>
      path-parameters: optional<map<string, HttpPathParameter>>
      auth: optional<boolean>
      idempotent: optional<boolean>
      stream-condition: optional<string>
      request: optional<HttpRequestSchema>
      response: optional<HttpResponseSchema>
      response-stream: optional<HttpResponseStreamSchema>
      errors: optional<list<ResponseError>>
      examples: optional<list<examples.ExampleEndpointCall>>
      pagination: optional<Pagination>
  
  HttpMethod: 
    enum: 
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
  
  HttpRequestSchema: 
    discriminated: false
    union: 
      - string
      - HttpRequestDetailed

  HttpRequestDetailed:
    extends: 
      - commons.WithName
      - commons.WithDocs
    properties: 
      content-type: optional<string>
      query-parameters: optional<map<string, HttpQueryParameterSchema>>
      headers: optional<map<string, HttpHeader>>
      body: optional<HttpRequestBody>
  
  HttpHeader: 
    extends: 
      - types.TypeReferenceDetailed
    properties: 
      env: optional<string>
  
  HttpRequestBody: 
    discriminated: false
    union: 
      - string
      - HttpReferencedRequestBody
      - HttpInlinedRequestBody
  
  HttpReferencedRequestBody: 
    extends: 
      - commons.WithDocs
    properties:
      type: string

  HttpInlinedRequestBody: 
    properties: 
      extends: optional<types.ObjectExtends>
      extra-properties: optional<boolean>
      properties: optional<HttpInlineRequestBodyProperty>

  HttpInlineRequestBodyProperty: 
    extends: 
      - types.TypeReferenceDetailed
    properties: 
      content-type: optional<string>
  
  HttpQueryParameterSchema: 
    discriminated: false
    union: 
      - string
      - QueryParameterTypeReferenceDetailed
  
  QueryParameterTypeReferenceDetailed: 
    extends: 
      - types.TypeReferenceDetailed
    properties: 
      allow-multiple: optional<boolean>
  
  HttpResponseSchema: 
    discriminated: false
    union: 
      - string
      - HttpResponseSchemaDetailed
  
  HttpResponseSchemaDetailed: 
    properties: 
      type: string
      property: optional<string>
      status-code: optional<integer>

  HttpResponseStreamSchema: 
    discriminated: false
    union: 
      - string
      - HttpResponseStreamSchemaDetailed
  
  HttpResponseStreamSchemaDetailed: 
    properties: 
      type: string
      format: optional<StreamFormat>
      terminator: optional<string>

  StreamFormat: 
    enum: 
      - sse
      - json
  
  HttpPathParameter: 
    discriminated: false
    union: 
      - types.TypeReference
      - VariableReferenceSchema
  
  VariableReferenceSchema: 
    extends: 
      - commons.WithDisplayName
      - commons.WithAvailability
    properties: 
      variable: string
  
  Pagination: 
    discriminated: false
    union: 
      - pagination.PaginationScheme
      - boolean

  ResponseError: 
    discriminated: false
    union: 
      - string
      - ResponseErrorWithDocs
  
  ResponseErrorWithDocs: 
    extends: 
      - commons.WithDocs
    properties: 
      error: string
